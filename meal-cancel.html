<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meal Cancellation -  Spoonify</title>
  <link rel="stylesheet" href="meal-cancel.css">
</head>
<body>
  <header class="main-header">
    <nav class="navbar">
      <div class="navbar-logo">Spoonify</div>
      <button id="hamburger-btn" aria-label="Open navigation" style="display:none;">
        <span class="hamburger-bar"></span>
        <span class="hamburger-bar"></span>
        <span class="hamburger-bar"></span>
      </button>
      <ul id="nav-links" class="navbar-links">
        <li><a href="index.html">Dashboard</a></li>
        <li><a href="mealshare.html">MealShare</a></li>
        <li><a href="menu.html">Menu Feedback</a></li>
        <li><a href="waste.html">Waste Tracker</a></li>
        <li><a href="meal-cancel.html" class="active">Meal Cancel</a></li>
        <li><a href="#" id="show-qr-link" style="display:none;">Show QR</a></li>
        <li><a href="#" id="signin-nav-link" class="navbar-signin">Sign In</a></li>
      </ul>
    </nav>
  </header>
  <!-- Sign In Modal -->
  <div id="signin-modal" class="modal-overlay" style="display:none;">
    <div class="modal-card">
      <form id="signin-form">
        <h2>Sign In</h2>
        <label>
          Username:
          <input type="text" id="signin-username" required>
        </label>
        <div>
          <label><input type="radio" name="role" value="user" checked> User</label>
          <label><input type="radio" name="role" value="admin"> Admin</label>
        </div>
        <div id="admin-password-field" style="display:none;">
          <label>
            Admin Password:
            <input type="password" id="signin-password">
          </label>
        </div>
        <button type="submit">Sign In</button>
      </form>
    </div>
  </div>
  <main>
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">Meal Cancellation</h1>
        <p class="hero-subtitle">Cancel your meal and avoid deduction if done at least 2 hours before meal time.</p>
        <div style="margin: 2rem 0;">
          <label for="meal-type">Select Meal:</label>
          <select id="meal-type">
            <option value="breakfast">Breakfast (7:00 AM)</option>
            <option value="lunch">Lunch (12:30 PM)</option>
            <option value="dinner">Dinner (8:30 PM)</option>
          </select>
        </div>
        <button id="cancel-meal-btn" class="feature-link animated-card">Cancel Meal</button>
        <div id="deduction-message" style="margin-top: 1.5rem; color: var(--peach-dark); font-weight: bold;"></div>
        <div id="balance-message" style="margin-top: 0.5rem; color: var(--peach-dark);"></div>
      </div>
    </section>
  </main>
  <script>
    // Example user balance
    let userBalance = 500;

    // Show initial balance
    document.addEventListener('DOMContentLoaded', function() {
      let userBalance = localStorage.getItem('userBalance') || 500;
      userBalance = parseInt(userBalance, 10);
      document.getElementById('balance-message').textContent = "Current Balance: ₹" + userBalance;
    });

    function getMealTime(selectedMeal) {
      const now = new Date();
      let mealTime = new Date(now);
      if (selectedMeal === "breakfast") {
        mealTime.setHours(7, 0, 0, 0);
      } else if (selectedMeal === "lunch") {
        mealTime.setHours(12, 30, 0, 0);
      } else if (selectedMeal === "dinner") {
        mealTime.setHours(20, 30, 0, 0);
      }
      // If meal time has already passed today, set for tomorrow
      if (mealTime < now) {
        mealTime.setDate(mealTime.getDate() + 1);
      }
      return mealTime;
    }

    document.getElementById('cancel-meal-btn').addEventListener('click', function() {
      const selectedMeal = document.getElementById('meal-type').value;
      const mealTime = getMealTime(selectedMeal);
      const now = new Date();
      const diffMs = mealTime - now;
      const diffHrs = diffMs / (1000 * 60 * 60);

      let message = '';
      if (diffHrs >= 2) {
        message = "Meal canceled successfully. No deduction.";
      } else if (diffHrs < 0) {
        message = "Meal time has already passed. Cannot cancel.";
      } else {
        let userBalance = localStorage.getItem('userBalance') || 500;
        userBalance = parseInt(userBalance, 10) - 70;
        localStorage.setItem('userBalance', userBalance);

        let userFine = localStorage.getItem('userFine') || 0;
        userFine = parseInt(userFine, 10) + 70;
        localStorage.setItem('userFine', userFine);
        message = "₹70 has been deducted as the meal was not canceled at least 2 hours before meal time.";
      }
      document.getElementById('deduction-message').textContent = message;
      let updatedBalance = localStorage.getItem('userBalance') || 500;
      document.getElementById('balance-message').textContent = "Current Balance: ₹" + updatedBalance;
    });
  </script>
  <script src="qrcode.min.js"></script>
  <script src="app.js"></script>
</body>
</html>